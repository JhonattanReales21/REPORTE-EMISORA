---
title: "Reporte Emisora Uninorte"
author: Jhonattan Reales De la Asunción (jhonattanr@uninorte.edu.co), José Navarro
  De la Cruz (jgnavarro@uninorte.edu.co)
date: "7/23/2020"
output:
  html_document:
    df_print: paged
  word_document:
    reference_docx: rmarkdown_template.docx
---

```{r global, include=FALSE}
library(tidyverse)
library(Hmisc)
library(gridExtra)
library(knitr)
library(RColorBrewer)
library(ggthemes)
library(viridis)


# Lectura de datos
Dane_paramodelos <- read.csv("Dane_paramodelos.csv", sep=",", fileEncoding = "Latin1")
Dane <- read.csv("Dane_Paramodelos_regresion.csv", header = T, sep = ",", dec = ".", fileEncoding = "Latin1")
Dane$Departamento <- as.factor(Dane$Departamento)
Dane$Departamento <- fct_collapse(Dane$Departamento, 
                                  "Antioquia"= "5", "Atlántico"="8", "Bogotá"="11", "Bolívar"="13", "Boyaca"="15",
                                  "Caldas"="17", "Caquetá"="18", "Cauca"="19", "Cesar"="20", "Córdoba"="23", 
                                  "Cundinamarca"="25", "Chocó"="27","Huila"="41", "La Guajira"="44", "Magdalena"="47", 
                                  "Meta"="50", "Nariño"="52", "Norte de Santander"="54","Quindío"="63", "Risaralda"="66",
                                  "Santander"="68", "Sucre"="70", "Tolima"="73", "Valle"="76")




                            ##### GENERAL OVERVIEW OF OCCUPATION ######

# TOTAL DATAFRAME
Y4_description <- describe(Dane_paramodelos)
Y4_description <- data.frame("Ocupación"=Y4_description$Y_modelo4$values$value, 
                             "Frecuencia"=Y4_description$Y_modelo4$values$frequency, 
                             "Proporción"=c(0.140, 0.659, 0.2))

# PER DEPARTAMENTO
Depto <- c(5, 8,11, 13, 15, 17, 18, 19, 20, 23, 25, 27, 41, 44, 47, 50, 52, 54, 63, 66, 68, 70, 73, 76 )
#Ocupado
Y4_oc_ocupado <- Dane_paramodelos %>% filter(Y_modelo4 == "Ocupado") %>% group_by(Departamento) %>% summarise(Frecuencia = n())
Y4_oc_ocupado$Departamento <- as.factor(Y4_oc_ocupado$Departamento)
Y4_oc_ocupado$Departamento <- fct_collapse(Y4_oc_ocupado$Departamento, "Antioquia"="5", "Atlantico"="8", "Bogota"= "11", "Bolivar"=  "13", 
                                                 "Boyaca"= "15", "Caldas"="17", "Caqueta"= "18", "Cauca"= "19",
                                                 "Cesar"=  "20", "Cordoba"= "23", "Cundinamarca"="25", "Choco"="27", 
                                                 "Huila"= "41", "La Guajira"="44","Magdalena"= "47", "Meta"="50",
                                                 "Nariño"="52", "Norte de Santander"="54", "Quindio"="63", 
                                                 "Risaralda"="66", "Santander"="68", "Sucre"="70","Tolima"=  "73", "Valle"="76")
Y4_oc_ocupado <- Y4_oc_ocupado %>% arrange(desc(Frecuencia))
Y4_oc_ocupado <- Y4_oc_ocupado[1:5,]
plot_ocupado <- ggplot(Y4_oc_ocupado, aes(x=reorder(Departamento, Frecuencia), y=Frecuencia)) + geom_col(color="black", fill="skyblue", position = "identity", alpha=0.5) + geom_text(aes(x=Departamento, y=Frecuencia, label=Frecuencia), hjust=-0.1) + 
  ggtitle("Departamentos más relevantes por ocupación") +
  labs(x="Departamento" ,y="Frecuencia", subtitle = "Ocupación Formal") + theme_bw() +  
  coord_flip() + 
  theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2")) +
  theme(text = element_text(size = 14), legend.position = "none")+
  theme(plot.subtitle = element_text(hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold", size=rel(0.8)))+
  theme(axis.text.y = element_text(face = "bold"))

#Informal
Y4_oc_informal <- Dane_paramodelos %>% filter(Y_modelo4 == "Informal") %>% group_by(Departamento) %>% summarise(Frecuencia = n())
Y4_oc_informal$Departamento <- as.factor(Y4_oc_informal$Departamento)
Y4_oc_informal$Departamento <- fct_collapse(Y4_oc_informal$Departamento, "Antioquia"="5", "Atlantico"="8", "Bogota"= "11", "Bolivar"=  "13", 
                                           "Boyaca"= "15", "Caldas"="17", "Caqueta"= "18", "Cauca"= "19",
                                           "Cesar"=  "20", "Cordoba"= "23", "Cundinamarca"="25", "Choco"="27", 
                                           "Huila"= "41", "La Guajira"="44","Magdalena"= "47", "Meta"="50",
                                           "Nariño"="52", "Norte de Santander"="54", "Quindio"="63", 
                                           "Risaralda"="66", "Santander"="68", "Sucre"="70","Tolima"=  "73", "Valle"="76")
Y4_oc_informal <- Y4_oc_informal %>% arrange(desc(Frecuencia))
Y4_oc_informal <- Y4_oc_informal[1:5,]
plot_informal <- ggplot(Y4_oc_informal, aes(x=reorder(Departamento, Frecuencia), y=Frecuencia)) + geom_col(color="black", fill="skyblue", position = "identity", alpha=0.5) + geom_text(aes(x=Departamento, y=Frecuencia, label=Frecuencia), hjust=-0.1) + 
  theme_bw() + 
  theme(plot.title = element_blank()) + 
  labs(x="Ocupación" ,y="Frecuencia", subtitle ="Ocupación Informal") +
  coord_flip() + 
  theme(text =element_text(size = 14), legend.position = "none")+
  theme(plot.subtitle = element_text(hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold", size=rel(0.8)))+
  theme(axis.text.y = element_text(face = "bold"))
#Desocupado
Y4_oc_desocupado <- Dane_paramodelos %>% filter(Y_modelo4 == "Desocupado") %>% group_by(Departamento) %>% summarise(Frecuencia = n())
Y4_oc_desocupado$Departamento <- as.factor(Y4_oc_desocupado$Departamento)
Y4_oc_desocupado$Departamento <- fct_collapse(Y4_oc_desocupado$Departamento, "Antioquia"="5", "Atlantico"="8", "Bogota"= "11", "Bolivar"=  "13", 
                                           "Boyaca"= "15", "Caldas"="17", "Caqueta"= "18", "Cauca"= "19",
                                           "Cesar"=  "20", "Cordoba"= "23", "Cundinamarca"="25", "Choco"="27", 
                                           "Huila"= "41", "La Guajira"="44","Magdalena"= "47", "Meta"="50",
                                           "Nariño"="52", "Norte de Santander"="54", "Quindio"="63", 
                                           "Risaralda"="66", "Santander"="68", "Sucre"="70","Tolima"=  "73", "Valle"="76")
Y4_oc_desocupado <- Y4_oc_desocupado %>% arrange(desc(Frecuencia))
Y4_oc_desocupado <- Y4_oc_desocupado[1:5,]
plot_desocupado <- ggplot(Y4_oc_desocupado, aes(x=reorder(Departamento, Frecuencia), y=Frecuencia)) + geom_col(color="black", fill="skyblue", position = "identity", alpha=0.5) + geom_text(aes(x=Departamento, y=Frecuencia, label=Frecuencia), hjust=-0.1) + 
  theme_bw() +
  ggtitle("Ramas de actividad en Inmigrantes Ocupados") +
  theme(plot.title = element_blank(), text = element_text(size=12)) + 
  labs(x="Ocupación" ,y="Frecuencia", subtitle="Ocupación Desocupado", caption="Tomando los 5 departamentos más relevantes") +
  coord_flip() + 
  theme(text =element_text(size = 14), legend.position = "none")+
  theme(plot.subtitle = element_text(hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold", size=rel(0.8)))+
  theme(axis.text.y = element_text(face = "bold"))





                        ##### ANALYSIS WITH RESPECT TO ACTIVITY CATEGORY ######
#Informal
Y4_Informal <- filter(Dane_paramodelos, Y_modelo4=="Informal")
Y4_Informal <- as.data.frame(table(as.factor(Y4_Informal$Rama.actividad)))
Y4_Informal <- arrange(Y4_Informal, desc(Freq))
Y4_Informal <- Y4_Informal[1:5, ]
oc_informal <- ggplot(Y4_Informal, aes(x=reorder(Var1, Freq), y=Freq)) + geom_col(color="black", fill="skyblue", position = "identity", alpha=0.5) + geom_text(aes(x=Var1, y=Freq, label=Freq), hjust=-0.1, size=3) + 
  ggtitle("Ramas de actividad en Inmigrantes Informales") +  theme_bw() +
  theme(plot.title = element_text(hjust=0.5, face="bold"), text = element_text(size=12), axis.title.y  = element_blank()) + 
 labs(x="Rama de Actividad" ,y="Frecuencia", subtitle = "Inmigrantes Informales") +
  coord_flip() + 
  theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2")) +
  theme(text = element_text(size = 14), legend.position = "none")+
  theme(plot.subtitle = element_text(hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold", size=rel(0.8)))+
  theme(axis.text.y = element_text(face = "bold"))
#Ocupado
Y4_Ocupado <- filter(Dane_paramodelos, Y_modelo4=="Ocupado")
Y4_Ocupado <- as.data.frame(table(as.factor(Y4_Ocupado$Rama.actividad)))
Y4_Ocupado <- arrange(Y4_Ocupado, desc(Freq))
Y4_Ocupado <- Y4_Ocupado[1:5, ]
oc_ocupado <- ggplot(Y4_Ocupado, aes(x=reorder(Var1, Freq), y=Freq)) + geom_col(color="black", fill="skyblue", position = "identity", alpha=0.5) + geom_text(aes(x=Var1, y=Freq, label=Freq), hjust=-0.1, size=3) + 
  ggtitle("Ramas de actividad en Inmigrantes Ocupados") + theme_classic() +
  theme(plot.title = element_blank(), text = element_text(size=12)) + 
 labs(x="Rama de Actividad" ,y="Frecuencia", subtitle = "Inmigrantes Ocupados") +
  coord_flip() + 
    theme(plot.title = element_blank()) +
  theme(text = element_text(size = 14), legend.position = "none")+
  theme(plot.subtitle = element_text(hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold", size=rel(0.8)))+
  theme(axis.text.y = element_text(face = "bold"))
#Desocupado
Y4_Desocupado <- filter(Dane_paramodelos, Y_modelo4=="Desocupado")
Y4_Desocupado <- as.data.frame(table(as.factor(Y4_Desocupado$Rama.actividad)))
Y4_Desocupado <- arrange(Y4_Desocupado, desc(Freq))
Y4_Desocupado <- Y4_Desocupado[1:5, ]
oc_desocupado <- ggplot(Y4_Desocupado, aes(x=reorder(Var1, Freq), y=Freq)) + geom_col(color="black", fill="skyblue", position = "identity", alpha=0.5) + geom_text(aes(x=Var1, y=Freq, label=Freq), hjust=-0.1, size=3) + 
  ggtitle("Ramas de actividad en Inmigrantes Desocupados") + theme_classic() +
  theme(plot.title = element_blank(), text = element_text(size=12), axis.title.y  = element_blank()) + 
 labs(x="Rama de Actividad" ,y="Frecuencia", caption="Tomando las 5 ramas más relevantes", subtitle = "Inmigrantes Desocupados") +
  coord_flip() + 
    theme(plot.title =element_blank()) +
  theme(text = element_text(size = 14), legend.position = "none")+
  theme(plot.subtitle = element_text(hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold", size=rel(0.8)))+
  theme(axis.text.y = element_text(face = "bold"))



Y4_activities <- NULL
for (Dep in Depto){
  set_act <- Dane_paramodelos %>% filter(Departamento==Dep, Y_modelo4 == "Informal") 
  set_act <- as.data.frame(table(as.factor(set_act$Rama.actividad)))  %>% mutate(Departamento=Dep)
  set_act <- arrange(set_act, desc(Freq))
  set_act <- set_act[1:5, ]
  Y4_activities <- rbind(Y4_activities, set_act)
}

Y4_activities$Departamento <- as.factor(Y4_activities$Departamento)
Y4_activities$Departamento <- fct_collapse(Y4_activities$Departamento, "Antioquia"="5", "Atlantico"="8", "Bogota"= "11", "Bolivar"=  "13", 
                                                 "Boyaca"= "15", "Caldas"="17", "Caqueta"= "18", "Cauca"= "19",
                                                 "Cesar"=  "20", "Cordoba"= "23", "Cundinamarca"="25", "Choco"="27", 
                                                 "Huila"= "41", "La Guajira"="44","Magdalena"= "47", "Meta"="50",
                                                 "Nariño"="52", "Norte de Santander"="54", "Quindio"="63", 
                                                 "Risaralda"="66", "Santander"="68", "Sucre"="70","Tolima"=  "73", "Valle"="76")






                      ##### ANALYSIS WITH RESPECT TO GENDER ######
Dane_paramodelos$Genero <- as.factor(Dane_paramodelos$Genero)
table(Dane_paramodelos$Genero)

#Imprimir esa tabla
Y4_gender <- Dane_paramodelos %>%  group_by(Genero, Y_modelo4) %>% summarise(Frecuencia=n())
Y4_gender$Proporcion <- c(Y4_gender[1,3]/9479, Y4_gender[2,3]/9479, Y4_gender[3,3]/9479, Y4_gender[4,3]/11653, Y4_gender[5,3]/11653, Y4_gender[6,3]/11653)
Y4_gender$Proporcion.Total <- Y4_gender$Frecuencia/sum(Y4_gender$Frecuencia)
Y4_female <- Y4_gender[1:3, ]
Y4_male <- Y4_gender[4:6, ]

# Compute the cumulative percentages (top of each rectangle)
Y4_female$ymax = cumsum(Y4_female$Proporcion)
Y4_male$ymax = cumsum(Y4_male$Proporcion)
# Compute the bottom of each rectangle
Y4_female$ymin = c(0, head(Y4_female$ymax, n=-1))
Y4_male$ymin = c(0, head(Y4_male$ymax, n=-1))
# Compute label position
Y4_female$labelPosition <- (Y4_female$ymax + Y4_female$ymin) / 2
Y4_male$labelPosition <- (Y4_male$ymax + Y4_male$ymin) / 2
# Compute a label text
Y4_female$label <- paste0("\n Frecuencia: ", Y4_female$Frecuencia)
Y4_male$label <- paste0("\n Frecuencia: ", Y4_male$Frecuencia)

female_plot <- ggplot(Y4_female, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=Y_modelo4)) +
  geom_rect(alpha=0.5, color="black") +
  geom_label( x=4, aes(y=labelPosition, label=label), size=3.3) +
  scale_fill_manual(name= "Tipo de Ocupación", values=c("yellow2","skyblue", "turquoise2")) +
  coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
  xlim(c(0.2, 4)) +  # Try to remove that to see how to make a pie chart
  theme_void() +  
  ggtitle("Ocupación de mujeres inmigrantes") + 
  theme(axis.text  = element_blank()) + 
    theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2")) 
  


male_plot <- ggplot(Y4_male, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=Y_modelo4)) +
  geom_rect(alpha=0.5, color="black") +
  geom_label( x=4, aes(y=labelPosition, label=label), size=3.3) +
  scale_fill_manual(name= "Tipo de Ocupación", values=c("yellow2","skyblue", "turquoise2")) +
  coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
  xlim(c(0.2, 4)) +  # Try to remove that to see how to make a pie chart
  theme_void() +  
  ggtitle("Ocupación de hombres inmigrantes") + 
  theme(axis.text  = element_blank()) + 
    theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2")) 


                                ##### ANALYSIS WITH RESPECT TO TIME IN COLOMBIA ######
# Imprimir esta tabla
Y4_time <- Dane_paramodelos %>% group_by(tiempo.en.colombia, Y_modelo4) %>% summarise(Frecuencia=n()) 

                                  ##### ANALYSIS WITH RESPECT TO EDUCATION LEVEL ######
#Imprimir esta tabla
Y4_education <- Dane_paramodelos %>%  group_by(Nivel.educativo.alcanzado, Y_modelo4) %>% summarise(Frecuencia = n())



############################################################################
###########################################################################
##########################################################################
          
          #-----------------------------------------.------------------------------------------------
          #----------------------- ANALISIS CON RESPECTO A LOS INGRESOS ----------------------------
          #-----------------------------------------.------------------------------------------------

#######.#######
#----------  Exploración de población con mayores ingreso #------
######.#######

pob_mayor_ingreso <- Dane %>% filter(Ingresos_total>2500000) %>% droplevels()

# ingreso con respecto a la ocupación
Ingresos_prom_mayor <- pob_mayor_ingreso %>% group_by(ocupacion) %>% summarise(`Ingreso promedio`=round(mean(Ingresos_total),0),
                                                                               `Ingreso máximo`=max(Ingresos_total),
                                                                               "# De observaciones"=n())

p_ocup_mayor <- Dane %>% filter(Ingresos_total>2500000) %>% 
  ggplot(aes(x=Ingresos_total)) + geom_histogram(bins = 60,fill="skyblue", color="black", alpha=0.8)+
  ggtitle("Distribución de ingresos según la ocupación", subtitle = "(observaciones con mayores ingresos)")+
  xlab("Ingresos totales")+ylab("") + theme_bw() + 
  theme(text =element_text(size = 14), legend.position = "none")+
  theme(plot.title = element_text(size = rel(1.2),hjust=0.5, vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(size = rel(0.8),hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold"))+
  theme(axis.text.y = element_text(face = "bold"))+ 
  scale_x_continuous(limits = c(2500000,15000000), breaks = c(3.0e+06,5.0e+06,7.0e+06,9.0e+06,11.0e+06,13.0e+06,15.0e+06))+
  geom_vline(data=Ingresos_prom_mayor, aes(xintercept=`Ingreso promedio`, color=ocupacion),
             linetype="dashed", size=1.2)+
  scale_fill_brewer(palette = "Set1")+scale_color_manual(values = c("black", "black"))+
  facet_grid(ocupacion~.)

#  ingreso con respecto al nivel educativo, grafico y tabla
Tabla_educ_mayor <- Dane %>% filter(Ingresos_total>2500000)%>%  group_by(Nivel.educativo.alcanzado) %>% 
  summarise("# De migrantes"=n(), "Q.1"=quantile(Ingresos_total, 0.25),
            "Mediana"=median(Ingresos_total), "Promedio de ingresos"=round(mean(Ingresos_total),0),
            "Q.3"=quantile(Ingresos_total, 0.75), "Ingreso maximo"=max(Ingresos_total)) %>% ungroup() %>%
  mutate("% Con respecto al total de la muestra" = paste(round((`# De migrantes`/sum(`# De migrantes`)) *100, 2),"%")) %>%
  select(1,5,2,8,3,4,6,7)%>% arrange(desc(`Promedio de ingresos`))

Tabla_educ_mayor$Nivel.educativo.alcanzado <- factor(Tabla_educ_mayor$Nivel.educativo.alcanzado, levels = Tabla_educ_mayor$Nivel.educativo.alcanzado)

p_educ_mayor <- Tabla_educ_mayor %>% ggplot(aes(x=Nivel.educativo.alcanzado, y= `Promedio de ingresos`, color=Nivel.educativo.alcanzado))+
  geom_point(size=10) + geom_segment(aes(x = Nivel.educativo.alcanzado,
                                         xend= Nivel.educativo.alcanzado,
                                         y=3000000,
                                         yend=`Promedio de ingresos`))+
  theme_bw()+ labs(title = "Ingreso promedio según nivel educativo alcanzado", subtitle ="(observaciones con mayores ingresos)")+ 
  xlab("")+ylab("")+scale_x_discrete(breaks="")+
  scale_y_continuous(breaks = c(3.0e+06,4.0e+06,5.0e+06,6.0e+06,7.0e+06, 8.0e+06), limits = c(3.0e+06, 8.0e+06))+
  theme(text =element_text(size = 14), legend.position = "bottom", legend.title = element_text(size = 0))+
  theme(plot.title = element_text(size = rel(1), vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(size = rel(0.8), vjust = 1.5, color="black") )+ 
  theme(axis.title.y = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.y = element_text(face = "bold")) + scale_color_viridis(option = "D", discrete = T )+
  geom_text(aes(x=Nivel.educativo.alcanzado, label= `Promedio de ingresos`),
            size=4.5, vjust=-1.5, hjust=0.5, col="black" )

# Analizamos las ramas de actividad 

Tabla_rama_mayor <- pob_mayor_ingreso %>%  group_by(Rama.actividad) %>% 
  summarise("# De migrantes en esta rama"=n(), "Q.1"=quantile(Ingresos_total, 0.25),
            "Mediana"=median(Ingresos_total), "Promedio de ingresos"=round(mean(Ingresos_total),0),
            "Q.3"=quantile(Ingresos_total, 0.75), "Ingreso maximo"=max(Ingresos_total)) %>% ungroup() %>%
  mutate("% de la muestra (>$2.5M) " = paste(round((`# De migrantes en esta rama`/sum(`# De migrantes en esta rama`)) *100, 2),"%")) %>%
  select(1,5,2,8,3,4,6,7)%>% arrange(desc(`Promedio de ingresos`))

# Analizamos la ubicación 

Tabla_dep_mayor <- pob_mayor_ingreso %>%  group_by(Departamento) %>% 
  summarise("# De migrantes en el departamento"=n(), "Q.1"=quantile(Ingresos_total, 0.25),
            "Mediana"=median(Ingresos_total), "Promedio de ingresos"=round(mean(Ingresos_total),0),
            "Q.3"=quantile(Ingresos_total, 0.75), "Ingreso maximo"=max(Ingresos_total)) %>% ungroup() %>%
  mutate("% de la muestra (>$2.5M) " = paste(round((`# De migrantes en el departamento`/sum(`# De migrantes en el departamento`)) *100, 2),"%")) %>%
  select(1,5,2,8,3,4,6,7)%>% arrange(desc(`Promedio de ingresos`))

# Analizamos la ubicación y la ocupación

Tabla_dep2_mayor <- pob_mayor_ingreso %>%  group_by(Departamento, ocupacion) %>% 
  summarise("# De observaciones"=n(), "Q.1"=quantile(Ingresos_total, 0.25),
            "Mediana"=median(Ingresos_total), "Promedio de ingresos"=round(mean(Ingresos_total),0),
            "Q.3"=quantile(Ingresos_total, 0.75), "Ingreso maximo"=max(Ingresos_total)) %>% ungroup() %>%
  mutate("% de la muestra (>$2.5M) " = paste(round((`# De observaciones`/sum(`# De observaciones`)) *100, 2),"%")) %>%
  select(1,2,6,3,9,4,5,7,8)%>% arrange(Departamento, desc(`Promedio de ingresos`))


#######.#######
#----------  Exploración de población con ingresos menores a $2.500.000 #-----
#######.######


#----------  Analisis por segmentos de ocupacion y genero ----------

#  frecuencia de ocupación en la base de datos
tabla1 <- Dane %>% filter(Ingresos_total<=2500000) %>% group_by(ocupacion) %>% summarise(Frecuencia=n()) %>% ungroup() %>% 
  mutate("%"=paste(round(Frecuencia/sum(Frecuencia), 2), "%")) %>% arrange(desc(Frecuencia))

##### 1. ASALARIADOS #####

# Filtramos las observaciones que ganen menos de 2.5 millones
filter(Dane, Ingresos_total>=2500000 & ocupacion=="Asalariado") %>% nrow() # Solo 104 asalariados ganan mas de $2.500.000
prueba <- Dane %>% filter(ocupacion=="Asalariado", Ingresos_total<=2500000)
summary(prueba$Ingresos_total)


# Observamos la distribución de ingresos de los asalariados 
p_asal <- prueba %>% ggplot(aes(x=Ingresos_total)) + geom_histogram(bins = 70,fill="skyblue", color="black")+
  ggtitle("Ingresos de Asalariados")+
  xlab("Ingresos totales")+ylab("") + theme_bw() + 
  theme(text =element_text(size = 14))+
  theme(plot.title = element_text(size = rel(1.4),hjust=0.5, vjust = 1.5, face = "bold", color="red2"))+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1)))+ theme(axis.text.x = element_text(face = "bold"))+
  theme(axis.text.y = element_text(face = "bold"))+
  geom_vline(aes(xintercept=mean(Ingresos_total)),
             color="black", linetype="dashed", size=1.2)

#Ingreso prom por genero
Ingresos_1_gen <- prueba %>% group_by(Genero) %>% summarise(`Ingreso promedio para asalariados`=round(mean(Ingresos_total),2),
                                                            "# De observaciones"=n()) %>% arrange(desc(`Ingreso promedio para asalariados`))


# Ingresos de asalariados dependiendo del genero
p_asal_gene1 <- prueba %>% ggplot(aes(x=Ingresos_total, fill=Genero)) +
  geom_histogram(bins = 30,color="black", position = "identity", alpha=0.5)+
  ggtitle("Ingresos de asalariados", subtitle = "Con respecto al género")+
  xlab("Ingresos totales")+ylab("") + theme_bw() + 
  theme(text =element_text(size = 14))+
  theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(face="italic",size = rel(1.1),hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold"))+
  theme(axis.text.y = element_text(face = "bold"))+ 
  scale_x_continuous(limits = c(0,2500000))+scale_y_continuous(breaks= seq(0,800, by=100))+
  geom_vline(data=Ingresos_1_gen, aes(xintercept=`Ingreso promedio para asalariados`, color=Genero),
             linetype="dashed", size=1.2)+
  scale_fill_brewer(palette = "Set1")+scale_color_manual(values = c("red", "blue")) 


p_asal_gene2 <- prueba %>% ggplot(aes(x=Ingresos_total)) +
  geom_histogram(bins = 30,color="black", fill="skyblue", position = "identity", alpha=0.5)+
  ggtitle("Ingresos de asalariados", subtitle = "Con respecto al género")+
  xlab("Ingresos totales")+ylab("") + theme_bw() + 
  theme(text =element_text(size = 14), legend.position = "none")+
  theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(face="italic", size = rel(1.1),hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold"))+
  theme(axis.text.y = element_text(face = "bold"))+ 
  scale_x_continuous(limits = c(0,2500000))+
  geom_vline(data=Ingresos_1_gen, aes(xintercept=`Ingreso promedio para asalariados`, color=Genero),
             linetype="dashed", size=1.2)+
  scale_fill_brewer(palette = "Set1")+scale_color_manual(values = c("red", "blue"))+
  facet_grid(Genero~.)


##### 2. NO ASALARIADOS ####

# Filtramos las observaciones que ganen menos de 2.5 millones
filter(Dane, Ingresos_total>=2500000 & ocupacion=="No asalariado") %>% nrow() # Solo 117 asalariados ganan mas de $2.500.000
prueba2 <- Dane %>% filter(ocupacion=="No asalariado" & Ingresos_total<=2500000)
summary(prueba2$Ingresos_total)

# Observamos la distribución de ingresos de los No asalariados 
p_No_asal <- prueba2 %>% ggplot(aes(x=Ingresos_total)) + geom_histogram(bins = 70,fill="skyblue", color="black")+
  ggtitle("Ingresos de No asalariados")+
  xlab("Ingresos totales")+ylab("") + theme_bw() + 
  theme(text =element_text(size = 14))+
  theme(plot.title = element_text(size = rel(1.4),hjust=0.5, vjust = 1.5, face = "bold", color="red2"))+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1)))+ theme(axis.text.x = element_text(face = "bold"))+
  theme(axis.text.y = element_text(face = "bold"))+
  geom_vline(aes(xintercept=mean(Ingresos_total)),
             color="black", linetype="dashed", size=1.2)

#Ingreso prom por genero para No asalariados
Ingresos_2_gen <- prueba2 %>% group_by(Genero) %>% summarise(`Ingreso promedio para No asalariados`=round(mean(Ingresos_total),2),
                                                             "# De observaciones"=n()) %>% arrange(desc(`Ingreso promedio para No asalariados`))

# Ingresos de No asalariados dependiendo del genero
p_No_asal_gen1 <- prueba2 %>% ggplot(aes(x=Ingresos_total, fill=Genero)) +
  geom_histogram(bins = 30,color="black", position = "identity", alpha=0.5)+
  ggtitle("Ingresos de No asalariados", subtitle = "Con respecto al género")+
  xlab("Ingresos totales")+ylab("") + theme_bw() + 
  theme(text =element_text(size = 14))+
  theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(face="italic",size = rel(1.1),hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold"))+
  theme(axis.text.y = element_text(face = "bold"))+ 
  scale_x_continuous(limits = c(0,2500000))+
  geom_vline(data=Ingresos_2_gen, aes(xintercept=`Ingreso promedio para No asalariados`, color=Genero),
             linetype="dashed", size=1.2)+
  scale_fill_brewer(palette = "Set1")+scale_color_manual(values = c("red", "blue")) 


p_No_asal_gen2 <- prueba2 %>% ggplot(aes(x=Ingresos_total)) +
  geom_histogram(bins = 30,color="black", fill="skyblue", position = "identity", alpha=0.8)+
  ggtitle("Ingresos de No asalariados", subtitle = "Con respecto al género")+
  xlab("Ingresos totales")+ylab("") + theme_bw() + 
  theme(text =element_text(size = 14), legend.position = "none")+
  theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(face="italic", size = rel(1.1),hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold"))+
  theme(axis.text.y = element_text(face = "bold"))+ 
  scale_x_continuous(limits = c(0,2500000))+
  geom_vline(data=Ingresos_2_gen, aes(xintercept=`Ingreso promedio para No asalariados`, color=Genero),
             linetype="dashed", size=1.2)+
  scale_fill_brewer(palette = "Set1")+scale_color_manual(values = c("red", "blue"))+
  facet_grid(Genero~.)


##### 3. AMBOS SECTORES ####

# Grafico y tabla de la distribución de ingresos dependiendo de la ocupación

Ingresos_prom <- Dane %>%filter(Ingresos_total<=2500000) %>%  group_by(ocupacion) %>% summarise(`Ingreso promedio`=round(mean(Ingresos_total),2))

p_ingresos_ocup <- Dane %>% filter(Ingresos_total<=2500000) %>% 
  ggplot(aes(x=Ingresos_total)) + geom_histogram(bins = 60,fill="skyblue", color="black", alpha=0.8)+
  ggtitle("Distribución de ingresos según la ocupación")+
  xlab("Ingresos totales")+ylab("") + theme_bw() + 
  theme(text =element_text(size = 14), legend.position = "none")+
  theme(plot.title = element_text(size = rel(1.2),hjust=0.5, vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(size = rel(1.2),hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold"))+
  theme(axis.text.y = element_text(face = "bold"))+ 
  scale_x_continuous(limits = c(0,2000000))+
  geom_vline(data=Ingresos_prom, aes(xintercept=`Ingreso promedio`, color=ocupacion),
             linetype="dashed", size=1.2)+
  scale_fill_brewer(palette = "Set1")+scale_color_manual(values = c("black", "black"))+
  facet_grid(ocupacion~.)

# Grafico y tabla de la distribución de ingresos para ambos sectores con respecto al género y la ocupación

Ingresos_ambos <- Dane %>%filter(Ingresos_total<=2500000) %>% group_by(Genero, ocupacion) %>% summarise(`Ingreso promedio`=round(mean(Ingresos_total),2),
                                                                                                        "# De observaciones"=n()) %>% arrange(desc(`Ingreso promedio`))

p_ingresos_ocup_gene <- Dane %>% filter(Ingresos_total<=2000000) %>% 
  ggplot(aes(x=Ingresos_total)) + geom_histogram(bins = 60,fill="skyblue", color="black", alpha=0.8)+
  ggtitle("Distribución de ingresos según la ocupación \ny el género")+
  xlab("Ingresos totales")+ylab("") + theme_bw() + 
  theme(text =element_text(size = 14), legend.position = "none")+
  theme(plot.title = element_text(size = rel(1.2),hjust=0.5, vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(size = rel(1.2),hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold"))+
  theme(axis.text.y = element_text(face = "bold"))+ 
  scale_x_continuous(limits = c(0,2000000))+
  geom_vline(data=Ingresos_ambos, aes(xintercept=`Ingreso promedio`, color=Genero),
             linetype="dashed", size=1.2)+
  scale_fill_brewer(palette = "Set1")+scale_color_manual(values = c("red", "blue"))+
  facet_grid(ocupacion~Genero)

#--------.---------
#----------  Analisis por departamentos ----------

# Tabla con ingresos por departamento
Tabla_dep2 <- Dane %>% filter(Ingresos_total<=2500000)%>%  group_by(Departamento) %>% 
  summarise("# De migrantes"=n(), "Q.1"=quantile(Ingresos_total, 0.25),
            "Mediana"=median(Ingresos_total), "Promedio de ingresos"=round(mean(Ingresos_total),0),
            "Q.3"=quantile(Ingresos_total, 0.75), "Ingreso maximo"=max(Ingresos_total)) %>% ungroup() %>%
  mutate("% Con respecto al total de la muestra" = paste(round((`# De migrantes`/sum(`# De migrantes`)) *100, 2),"%")) %>%
  select(1,5,2,8,3,4,6,7)%>% arrange(desc(`Promedio de ingresos`))

# Grafico con 12 departamentos con mayor ingreso promedio
t2 <- Tabla_dep2 %>% mutate("rank"=min_rank(desc(`Promedio de ingresos`))) %>%
  filter(rank %in% 1:12) 
t2$Departamento <- factor(t2$Departamento, levels = t2$Departamento)

p_dep_mejor <- t2 %>% ggplot(aes(x=Departamento, y= `Promedio de ingresos`, color=Departamento))+
  geom_point(size=7) + geom_segment(aes(x = Departamento,
                                        xend= Departamento,
                                        y=670000,
                                        yend=`Promedio de ingresos`))+ ylim(670000,815000)+
  theme_bw()+ labs(title = "Ingreso económico promedio", subtitle = "De migrantes por departamento")+ 
  xlab("")+ylab("")+scale_x_discrete(breaks="")+
  scale_y_continuous(breaks = c(680000, 700000, 720000, 740000, 760000,780000, 800000  ))+
  theme(text =element_text(size = 14))+
  theme(plot.title = element_text(size = rel(1.1), vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(size = rel(1), vjust = 1.5, color="black") )+ 
  theme(axis.title.y = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.y = element_text(face = "bold")) + scale_color_brewer(palette ="Paired" )+
  geom_text(aes(x=Departamento, label= `Promedio de ingresos`),
            size=3.5, vjust=-1.3, hjust=0.5, col="black" )

# Grafico con 12 departamentos con menor ingreso promedio
t3 <- Tabla_dep2 %>% mutate("rank"=min_rank(desc(`Promedio de ingresos`))) %>%
  filter(rank %in% 13:24) 

t3$Departamento <- factor(t3$Departamento, levels = t3$Departamento)

p_dep_menor <- t3 %>% ggplot(aes(x=Departamento, y= `Promedio de ingresos`, color=Departamento))+
  geom_point(size=7) + geom_segment(aes(x = Departamento,
                                        xend= Departamento,
                                        y=460000,
                                        yend=`Promedio de ingresos`))+ ylim(460000,700000)+
  theme_bw()+ labs(title = "Ingreso económico promedio", subtitle = "De migrantes por departamento")+ 
  xlab("")+ylab("")+scale_x_discrete(breaks="")+
  scale_y_continuous(breaks = c(480000, 510000, 540000, 570000, 600000,630000, 660000,690000 ))+
  theme(text =element_text(size = 14))+
  theme(plot.title = element_text(size = rel(1.1), vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(size = rel(1), vjust = 1.5, color="black") )+ 
  theme(axis.title.y = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.y = element_text(face = "bold")) + scale_color_brewer(palette ="Paired" )+
  geom_text(aes(x=Departamento, label= `Promedio de ingresos`),
            size=3.5, vjust=-1.3, hjust=0.5, col="black" )


#--------.---------
#----------  Analisis por edad ----------

# Tabla y grafico sobre el ingreso por edad
t4 <- Dane %>% filter(Ingresos_total<=2500000)%>% group_by(Edad) %>% summarise(`Ingreso promedio`=round(mean(Ingresos_total), 0),`# De observaciones`=n() ) %>% 
  arrange(desc(`Ingreso promedio`))

p_ingresos_edad <- Dane %>% filter(Ingresos_total<=2500000)%>% 
  ggplot(aes(x=Edad, y=Ingresos_total, fill=Edad))+geom_boxplot()+theme_stata(base_size = 15 )+
  labs(title = "INGRESOS SEGÚN RANGO DE EDAD")+xlab("")+ scale_x_discrete(breaks="")+ylab("Ingresos por persona")+
  theme(plot.title = element_text(size = rel(1.1), vjust = 1.5, face = "bold", color="black") )+ 
  theme(axis.title.y = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.y = element_text(face = "bold"))+ scale_fill_viridis(discrete = T, option = "E", alpha = 0.8)+
  coord_flip()+stat_summary()

#--------.---------
#----------  Analisis por nivel educativo ----------

# Tabla y grafico sobre el ingreso por nivel educativo
t5 <- Dane %>% filter(Ingresos_total<=2500000)%>%
  group_by(Nivel.educativo.alcanzado) %>% 
  summarise(Ingreso_promedio=round(mean(Ingresos_total),0),
            mediana=median(Ingresos_total),
            `# De observaciones`=n()) %>% arrange(desc(mediana))

Dane$Nivel.educativo.alcanzado <- factor(Dane$Nivel.educativo.alcanzado, levels = t5$Nivel.educativo.alcanzado)

p_ingresos_educ <- Dane %>% filter(Ingresos_total<=2500000)%>% 
  ggplot(aes(x=Nivel.educativo.alcanzado, y=Ingresos_total, fill=Nivel.educativo.alcanzado))+geom_boxplot()+theme_stata(base_size = 15 )+
  labs(title = "INGRESOS SEGÚN NIVEL EDUCATIVO")+xlab("")+ scale_x_discrete(breaks="")+ylab("Ingresos por persona")+
  theme(plot.title = element_text(size = rel(1.1), vjust = 1.5, face = "bold", color="black") )+ 
  theme(axis.title.y = element_text(face = "bold", size= rel(1.1)), legend.title = element_blank())+ 
  theme(axis.text.y = element_text(face = "bold"))+ scale_fill_viridis(discrete = T, option = "E", alpha = 0.8)+
  coord_flip()+stat_summary()


#--------.---------
#----------  Analisis por Rama de actividad ----------

# Tabla filtrando los migrantes con ingresos menores a $2.5000.000
Tabla_rama1 <- Dane %>% filter(Ingresos_total<=2500000)%>%  group_by(Rama.actividad) %>% 
  summarise("# De migrantes en esta rama"=n(), "Q.1"=quantile(Ingresos_total, 0.25),
            "Mediana"=median(Ingresos_total), "Promedio de ingresos"=round(mean(Ingresos_total),0),
            "Q.3"=quantile(Ingresos_total, 0.75), "Ingreso maximo"=max(Ingresos_total)) %>% ungroup() %>%
  mutate("Porcentaje de la muestra" = paste(round((`# De migrantes en esta rama`/sum(`# De migrantes en esta rama`)) *100, 2),"%")) %>%
  mutate("Rama.actividad"=unique(Rama.actividad)) %>% select(1,5,2,8,3,4,6,7)%>% arrange(desc(`Promedio de ingresos`)) 


# Tabla sin ningún tipo de filtro
Tabla_rama2 <- Dane %>%  group_by(Rama.actividad) %>% 
  summarise("# De migrantes en esta rama"=n(), "Q.1"=quantile(Ingresos_total, 0.25),
            "Mediana"=median(Ingresos_total), "Promedio de ingresos"=round(mean(Ingresos_total),0),
            "Q.3"=quantile(Ingresos_total, 0.75), "Ingreso maximo"=max(Ingresos_total)) %>% ungroup() %>%
  mutate("Porcentaje de la muestra" = paste(round((`# De migrantes en esta rama`/sum(`# De migrantes en esta rama`)) *100, 2),"%")) %>%
  mutate("Rama.actividad"=unique(Rama.actividad)) %>% select(1,5,2,8,3,4,6,7)%>% arrange(desc(`Promedio de ingresos`))


#--------.---------
#----------  Analisis por variables en conjunto ----------

# Tabla de departamento y rama de actividad filtrando las personas con ingresos menores a $2.500.000
# y filtrando las ramas que tengan mas de 10 observaciones en cada departamento
Tabla_Dep_Rama_1 <- Dane %>% filter(Ingresos_total<=2500000)%>%  group_by(Departamento, Rama.actividad) %>% 
  summarise("# De migrantes en esta rama"=n(), "Q.1"=quantile(Ingresos_total, 0.25),
            "Mediana"=median(Ingresos_total), "Promedio de ingresos"=round(mean(Ingresos_total),0),
            "Q.3"=quantile(Ingresos_total, 0.75), "Ingreso maximo"=max(Ingresos_total)) %>% ungroup() %>% group_by(Departamento) %>% 
  mutate("Porcentaje del departamento" = paste(round((`# De migrantes en esta rama`/sum(`# De migrantes en esta rama`)) *100, 2),"%")) %>% 
  filter(`# De migrantes en esta rama` >=10) %>%
  mutate("rank"=min_rank(desc(`Promedio de ingresos`))) %>% filter(rank %in% 1) %>% arrange(desc(`Promedio de ingresos`)) %>% 
  select(1,2,6,3,9,4,5,7,8) 


# Tabla de departamento y rama de actividad sin ningún filtro de ingresos, 
# filtrando las ramas con 5 observaciones o mas por departamento
Tabla_Dep_Rama_2 <- Dane %>%  group_by(Departamento, Rama.actividad) %>% 
  summarise("# De migrantes en esta rama"=n(), "Q.1"=quantile(Ingresos_total, 0.25),
            "Mediana"=median(Ingresos_total), "Promedio de ingresos"=round(mean(Ingresos_total),0),
            "Q.3"=quantile(Ingresos_total, 0.75), "Ingreso maximo"=max(Ingresos_total)) %>% ungroup() %>% group_by(Departamento) %>% 
  mutate("Porcentaje del departamento" = paste(round((`# De migrantes en esta rama`/sum(`# De migrantes en esta rama`)) *100, 2),"%")) %>% 
    filter(`# De migrantes en esta rama` >=5) %>%
  mutate("rank"=min_rank(desc(`Promedio de ingresos`))) %>% filter(rank %in% 1) %>% arrange(Departamento, desc(`Promedio de ingresos`)) %>% 
  select(1,2,6,3,9,4,5,7,8)


# Grafico y tabla de ingresos según género y edad

Ingresos_gen_edad <- Dane  %>% filter(Ingresos_total<=1800000, Edad!="(11,14]") %>%  group_by(Genero, Edad) %>% 
  summarise(`Ingreso promedio`=round(mean(Ingresos_total),2), `# De observaciones`=n()) %>% 
  arrange(desc(`Ingreso promedio`))

p_ingresos_gen_edad <- Dane %>% filter(Ingresos_total<=1800000, Edad!="(11,14]") %>% 
  ggplot(aes(x=Ingresos_total)) + geom_histogram(bins = 60,fill="skyblue", color="black", alpha=0.8)+
  ggtitle("Distribución de ingresos por edad y genéro")+
  xlab("Ingresos totales")+ylab("") + theme_bw() + 
  theme(text =element_text(size = 14), legend.position = "none")+
  theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(size = rel(1.2),hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold", size = rel(0.9)))+
  theme(axis.text.y = element_text(face = "bold"))+ 
  scale_x_continuous(limits = c(0,1800000))+
  geom_vline(data=Ingresos_gen_edad, aes(xintercept=`Ingreso promedio`, color=Genero),
             linetype="dashed", size=1.2)+
  scale_fill_brewer(palette = "Set1")+scale_color_manual(values = c("red", "blue"))+
  facet_grid(Genero~Edad)




# Tabla y grafico de ingresos según la edad y el nivel educativo

Ingresos_edad_educ <- Dane %>% filter(Ingresos_total<=2500000) %>% filter(!(Nivel.educativo.alcanzado=="Preescolar")) %>% 
  group_by(Edad, Nivel.educativo.alcanzado) %>% summarise(`Ingreso promedio`=round(mean(Ingresos_total),2), `# De observaciones`=n()) %>% 
  arrange(desc(`Ingreso promedio`))

p <-  Dane %>% filter(Ingresos_total<=2500000,Edad!="(11,14]") %>% filter(!(Nivel.educativo.alcanzado=="Preescolar")) %>% 
  group_by(Edad) %>% summarise(`Ingreso promedio`=round(mean(Ingresos_total),2), `# De observaciones`=n()) %>% 
  arrange((`Ingreso promedio`))

Dane$Edad <- factor(Dane$Edad, levels = p$Edad)

I <- Dane %>% filter(Ingresos_total<=2500000, Edad!="(11,14]") %>% filter(!(Nivel.educativo.alcanzado=="Preescolar")) %>% 
  group_by(Edad, Nivel.educativo.alcanzado) %>% summarise(`Ingreso promedio`=round(mean(Ingresos_total),2), `# De observaciones`=n()) %>% 
  arrange(desc(`Ingreso promedio`))

p_ingresos_edad_educ <- Dane %>% filter(Ingresos_total<=2000000, Edad!="(11,14]") %>% filter(!(Nivel.educativo.alcanzado=="Preescolar")) %>% 
  ggplot(aes(x=Ingresos_total)) + geom_histogram(bins = 60,fill="skyblue", color="black", alpha=0.8)+
  ggtitle("Distribución de ingresos por edad y nivel educativo")+
  xlab("Ingresos totales")+ylab("") + theme_bw() + 
  theme(text =element_text(size = 14), legend.position = "none")+
  theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(size = rel(1.2),hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold", size=rel(0.8)))+
  theme(axis.text.y = element_text(face = "bold"))+ 
  scale_x_continuous(limits = c(0,2000000))+
  geom_vline(data=I, aes(xintercept=`Ingreso promedio`, color=Edad),
             linetype="dashed", size=1.2)+scale_color_brewer(palette = "Set1")+
  facet_grid(Edad~Nivel.educativo.alcanzado)



```

## INTRODUCCIÓN

El presente reporte tiene como objetivo presentar un análisis exploratorio de la situación de los inmigrantes en Colombia a partir de la base de datos de la Gran Encuesta Integrada de Hogares (GEIH) realizada por el departamento administrativo nacional de estadística (DANE), mediante la cual se solicita información sobre las condiciones de empleo de las personas (si trabajan, en qué trabajan, cuánto ganan, si tienen seguridad social en salud o si están buscando empleo), además de las características generales de la población como sexo, edad, estado civil y nivel educativo, se pregunta sobre sus fuentes de ingresos. Esta encuesta proporciona datos de las personas a nivel nacional, regional, departamental y de las capitales de los departamentos. Los datos recolectados para este análisis van desde Enero del 2019 hasta Febrero de 2020.
El reporte pretende abarcar aspectos como ocupación, haciendo especial énfasis en el empleo informal y en las variables más importantes cuando se toca el tema de informalidad. Además, se presentarán las ramas de actividad más relevantes y cómo estas se relacionan con los departamentos. Adicionalmente, se muestra cómo se distribuyen los ingresos y las variaciones que este tiene con respecto a múltiples variables entre las que se encuentran el sexo. Finalmente se dirá cuáles regiones presentan un mejor y peor escenario con respecto a los ingresos.



# ***ANÁLISIS DE OCUPACIÓN***

### Panorama General

De manera general, se registraron para este análisis los niveles de ocupación Ocupado, Informal y Desocupado. De acuerdo al DANE, se pueden definir de la siguiente manera:

* Ocupado: Corresponde a la persona que durante el período de referencia trabajó por lo menos una hora remunerada en la semana de referencia; no trabajó la semana de referencia pero tenía un trabajo, y que sea trabajador familiar sin remuneración y trabajó en la semana de referencia por lo menos 1 hora. 

* Informal: Hace referencia a los empleados particulares y los obreros que laboran en establecimientos, negocios o empresas que ocupen hasta cinco personas en todas sus agencias y sucursales, incluyendo al patrono y/o socio; los trabajadores familiares sin remuneración; los trabajadores sin remuneración en empresas o negocios de otros hogares; Los empleados domésticos; los jornaleros o peones; los trabajadores por cuenta propia que laboran en establecimientos hasta cinco personas, excepto los independientes profesionales y los patrones o empleadores en empresas de cinco trabajadores o menos. 

* Desocupado: Se incluye la población que en la semana de referencia se encontraba sin empleo; hicieron diligencias en el último mes; No hicieron diligencias en el último mes, pero sí en los últimos 12 meses y tienen una razón válida de desaliento; poseen disponibilidad. 

De acuerdo a lo presentado anteriormente, se observa en la Tabla 1, que los empleados informales representan la gran mayoría de las personas encuestadas. En este sentido, se observa que los informales abarcan el 65,9% del total de encuestados, mientras que los ocupados le siguen en segundo lugar con el 20% y los desocupados con el 14% 


```{r, echo=FALSE, fig.cap="Tabla 1: Distribución de Inmigrantes según su ocupación", fig.align="center"}
kable(Y4_description, caption = "Tabla 1: Distribución de Inmigrantes según su ocupación")
```




La Figura 1 muestra gráficamente cómo se distribuye la ocupación entre los inmigrantes encuestados por el DANE.




```{r, echo=FALSE, fig.cap="Figura 1: Distribución de Inmigrantes según su ocupación", fig.align="center"}
ggplot(Y4_description, aes(x=Ocupación, y=Frecuencia)) + geom_col(color="black", fill="skyblue", position = "identity", alpha=0.5) + 
  geom_text(aes(x=Ocupación, y=Frecuencia, label=Frecuencia), vjust=-0.3) + 
  ggtitle("Ocupación de inmigrantes en Colombia") +  theme_bw() +
  theme(plot.title = element_text(hjust=0.5, face = "bold"), text = element_text(size=12)) + 
  theme(text =element_text(size = 14))+
  theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2") )+ 
  theme(plot.subtitle = element_text(face="italic",size = rel(1.1),hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold"))+
  theme(axis.text.y = element_text(face = "bold")) 
 
```

Realizando un análisis por departamento, es posible identificar en la Figura 2 que la informalidad predomina en departamentos como Norte de Santander, Magdalena, La Guajira, Atlántico y Cesar entre otros. Asimismo se observa que para todos los departamentos graficados, el volumen de individuos informales predomina sobre los que están desocupados o los que tienen algún tipo de ocupación.

Por otro lado, se observa que en Atlántico, Antioquia y Bogotá, se encuentra una alta concentración de individuos ocupados. Estos departamentos, junto con Valle y Santander, son los 5 departamentos con mayor volumen de ocupados de acuerdo a la encuesta GEIH.

Con respecto a la desocupación, es evidente que Norte de Santander concentra un alto volumen de población que cae dentro de esta categoría, además de la ya mencionada alta cantidad de inmigrantes informales que ya reporta.

```{r, echo=FALSE, fig.cap="Figura 2: Distribución de Inmigrantes según su ocupación por departamento", fig.align="center", fig.width=7, fig.height=7}
grid.arrange(plot_ocupado, plot_informal, plot_desocupado, nrow=3)

```

### Exploración de ocupación con respecto a Ramas de Actividad

El DANE distingue de acuerdo a la Clasificación Industrial Internacional Uniforme de todas las Actividades Económicas (CIIU) múltiples ramas de actividad. De acuerdo a la cuesta realizada, se tiene un total de 56 ramas de actividad, las cuales corresponden a las actividades económicas que desempeñan los inmigrantes encuestados. 

La Figura 3 muestra de forma general cuáles son las ramas más relevantes de acuerdo con la ocupación de los individuos. De allí se puede evidenciar que la rama con mayor predominancia en todos los niveles de ocupación es la de comercio al por mayor y al por menor. Esta incluye la reventa de productos nuevos o usados a minoristas, usuarios industriales, comerciales, institucionales o profesionales, a otros mayoristas, y a quienes actúan en calidad de agente o corredor en la compra o venta de mercancías en nombre de dichas personas o empresas. También incluye la reventa, al público en general, realizada en almacenes por departamentos, tiendas, supermercados, comisariatos, o cooperativas de consumidores, vendedores ambulantes, sistemas de ventas por teléfono o correo, etc. de productos nuevos, para su consumo y uso personal o doméstico.

En segundo lugar está la rama de hoteles, restaurantes, bares y similares. La cual incluye el suministro, a cambio de una retribución, de alojamiento u hospedaje no permanente y de instalaciones o lugares para acampar, tanto al público en general, como exclusivamente a afiliados a una determinada organización, así como los servicios de restaurante que se prestan en combinación con los de alojamiento.

Lo anterior indica que la gran mayoría de inmigrantes, independientemente de su ocupación, se desempeñan en dichas ramas de actividad de acuerdo a la encuesta del DANE.

```{r, echo=FALSE, fig.cap="Figura 3: Ramas de ocupación más relevantes", fig.align="center", fig.width=7.5, fig.height=5}

grid.arrange(oc_informal, oc_ocupado, oc_desocupado, nrow=3)

```




Similar al análisis realizado en la Figura 2, las principales ramas de actividad por departamento para los inmigrantes que cuentan con un estado de informalidad se presenta en la Figura 4. Allí se evidencia que en departamentos como Atlántico, Norte de Santander, La Guajira o Magdalena, se concentran la mayor cantidad de inmigrantes informales que laboran en las áreas de Comercio al por mayor y menor, así como también en Hoteles, restaurantes, bares y similares.

En otros departamentos, como Cesar, Sucre, Atlántico, Bolivar, o La Guajira se aprecia que también destaca la rama de Hogares privados con servicio doméstico, la cual hace referencia a los hogares privados que emplean personal doméstico de todo tipo, como sirvientes, cocineros, camareros, ayudas de cámara, mayordomos, lavanderos, jardineros, porteros, mozos de cuadra, choferes, conserjes, institutrices, niñeras, preceptores, secretarios, entre otros.

Por otro lado, en los departamentos anteriormente mencionados también destacan las actividades de construcción, que incluyen los trabajos de demolición y preparación de terrenos para la construcción de edificaciones, la construcción de edificaciones para uso residencial y no residencial, acondicionamiento de edificaciones y de obras civiles y la terminación y acabado de edificaciones y obras civiles entre otros.



```{r, echo=FALSE, fig.cap="Figura 3: Ramas de ocupación más relevantes por departamento", fig.align="center",fig.width=8, fig.height=8.5}

ggplot(Y4_activities, aes(x=Var1, y=Freq)) + geom_col(color="black", fill="skyblue", position = "identity", alpha=0.5) + geom_text(aes(x=Var1, y=Freq, label=Freq), hjust=-0.1, size=3) + coord_flip() + 
  ggtitle("Ramas de actividad relevantes para inmigrantes informales") +   theme_bw()  + 
  theme(plot.title = element_text(face = "bold"), text = element_text(size=12)) + 
  facet_wrap(~Departamento) + 
  xlab("Ramas de actividad") + 
  theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2")) +
  theme(text = element_text(size = 14), legend.position = "none")+
  theme(plot.subtitle = element_text(hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold", size=rel(0.8)))+
  theme(axis.text.y = element_text(face = "bold"))

```



### Situación con respecto al género

Para tener una visión más clara de cómo se distribuyen los niveles de ocupación entre los hombres y mujeres, en esta sección se presenta el análisis comparando la ocupación para dichos géneros. La Tabla 2 resume los hallazgos principales. Allí se evidencia que la informalidad predomina en altos niveles similares para ambos sexos, representando así el 66,5% de los hombres y el 65,2% de las mujeres.
Otra observación relevante es que la proporción de hombres ocupados es superior a la de mujeres ocupadas (13,1% y 6,9% para hombres y mujeres respectivamente, con respecto al total de la base de datos). Por lo tanto, se deduce que la proporción de mujeres desocupadas es superior que la de hombres desocupado. Esto también puede ser comprobado en la Tabla 2

```{r, echo=FALSE, fig.cap="Tabla 2: Ocupación de acuerdo al género", fig.align="center"}
kable(Y4_gender, caption = "Tabla 2: Ocupación de acuerdo al género")
```



La Figura 4 presenta de manera más gráfica la información principal de la distribución de los niveles de ocupación según el género. 




```{r, echo=FALSE, fig.cap="Figura 4: Ocupación según sexo", fig.width=8.5, fig.height=5}
grid.arrange(female_plot, male_plot,nrow=1)
```


### Análisis con respecto al tiempo en Colombia

La GEIH también analiza dentro de sus variables el tiempo que llevan los inmigrantes en territorio colombiano. Con respecto a ello, la Tabla 3 resume la información más relevante. De allí es posible señalar que el número de inmigrantes que llevan de 1 a 5 años en Colombia predomina sobre los que llevan más de 5 años y menos de 1 año. Siendo en todos los casos la población de ocupación informal como la más prominente, seguida por ocupado y finalmente desocupado.


```{r, echo=FALSE, fig.cap="Tabla 3: Ocupación según tiempo en Colombia", fig.align="center"}
kable(Y4_time, caption = "Tabla 3: Ocupación según tiempo en Colombia")
```





Con el fin de complementar la información presentada por la Tabla 3. La Figura 5 muestra cómo se distribuyen los distintos niveles de ocupación de acuerdo al tiempo en Colombia que lleven los inmigrantes. Se distingue claramente que la informalidad predomina sobre los otros niveles de ocupación. Adicionalmente, el volumen de encuestados informales es muy superior para los que llevan de 1 a 5 años en Colombia.
Por otro lado, no se tiene evidencia que un mayor tiempo en Colombia influya en obtener algún tipo de empleo u ocupación laboral, dado que el volumen de la población que lleva más de 5 años en Colombia no es significativamente alto en el nivel de ocupado. Similarmente, se aprecia que el volumen de las personas ocupadas que llevan menos de 1 año en Colombia es similar al volumen de las que se encuentran desocupadas.


```{r, echo=FALSE, fig.cap="Figura 4: Ocupación según tiempo en Colombia"}
ggplot(Y4_time, aes(x=Y_modelo4, y=Frecuencia, fill=tiempo.en.colombia)) + 
  geom_bar(position="dodge", stat = "identity", alpha=0.5, color="black") + 
  scale_fill_manual(name="Tiempo en Colombia", values=c("yellow2","skyblue", "turquoise2")) +
  ggtitle("Ocupación según tiempo en Colombia") +
  xlab("Ocupación") +
  ylab("Frecuencia") +
  theme_bw() + 
    theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2")) +
  theme(text = element_text(size = 14), legend.position = "none")+
  theme(plot.subtitle = element_text(hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold", size=rel(0.8)))+
  theme(axis.text.y = element_text(face = "bold"))

```



### Panorama con respecto al nivel de educación


El DANE también registra el nivel de educación de los encuestados. En este caso se clasifican los niveles de educación de acuerdo a la denominación de Educación formal, concepto que abarca los niveles de educación preescolar, básica, que se divide en primaria y secundaria y finalmente media, adicional a la cual también se incorpora la formación superior o universitaria.
La tabla 4 presenta de forma resumida la información. Allí se puede identificar que la población de inmigrantes informales predomina en todos los niveles educativos. Similarmente, la mayor cantidad de encuestados poseen una formación media o básica secundaria.
La población que mayor volumen de ocupación presenta es la que alcanzó un nivel de educación media, con 1846 individuos que corresponde al 8,7% del total, seguida por la educación superior o universitaria con 1520, que representa el 7,2% del total de encuestados.




```{r, echo=FALSE, fig.cap="Tabla 4: Ocupación según nivel educativo alcanzado", fig.align="center"}
kable(Y4_education, caption = "Tabla 4: Ocupación según nivel educativo alcanzado")
```





Por otro lado, la Figura 5 muestra de manera gráfica cómo se da esta distribución de ocupación basado en los distintos niveles educativos. Tal como se espera a partir de análisis anteriores, el nivel de Informal tiene el mayor número de observaciones.

La mayoría de inmigrantes encuestados por el DANE que llegan a Colombia lo hacen con un nivel de educación media, seguido de superior o universitaria y básica secundaria. Por lo cual es notorio que las personas que componen este flujo migratorio tienen cierto grado de preparación laboral.

Asimismo, es significativo resaltar que para el nivel de ocupado, no existe una diferencia amplia entre aquellos que poseen una educación media o una superior, lo cual podría indicar que las personas con estos niveles de educación obtienen algún tipo de empleo aproximadamente en la misma medida.

Similarmente, para el nivel de desocupado, se aprecia que el volumen de personas que cuentan con una preparción superior es muy similar al de las personas con educación básica secundaria. Cabe aclarar que en este caso, la población de Desocupados es inferior a las de los demás niveles, lo cual demuestra un alto volumen de inmigrantes que están haciendo algún tipo de actividad económica.


```{r, echo=FALSE, fig.cap="Figura 5: Ocupación según nivel educativo", fig.width=9.3}
ggplot(Y4_education, aes(x=reorder(Nivel.educativo.alcanzado, Frecuencia), y=Frecuencia)) + geom_col(color="black", fill="skyblue", position = "identity", alpha=0.5) + theme_bw() +
  ggtitle("Niveles de educación Inmigrantes en Colombia") + 
  theme(plot.title = element_text(hjust=0.5, face="bold"), text = element_text(size=12)) + 
  labs(x="Nivel de educación" ,y="Frecuencia") +
  coord_flip() + facet_wrap(~Y_modelo4) + 
      theme(plot.title = element_text(size = rel(1.3),hjust=0.5, vjust = 1.5, face = "bold", color="red2")) +
  theme(text = element_text(size = 14), legend.position = "none")+
  theme(plot.subtitle = element_text(hjust=0.5, vjust = 1.5, color="black") )+ 
  theme(axis.title.x = element_text(face = "bold", size= rel(1.1)))+ 
  theme(axis.text.x = element_text(face = "bold", size=rel(0.8)))+
  theme(axis.text.y = element_text(face = "bold"))


```




# ***ANALISIS DE INGRESOS***


#### Un primer comentario

bla bla bla

* esto
* aquello
* y lo otro

bla bla bla
 
 
## **Exploración de población con mayores ingresos (>$2.5M)**
 

bla bla  

#### Con respecto a la ocupación
 
bla bla

```{r, echo=FALSE, fig.align="center"}
kable(Ingresos_prom_mayor, caption = "Tabla : Ingreso promedio según ocupación (>$2.5M)", align = "c")
```


```{r, echo=FALSE, fig.cap="Figura : Ingresos según ocupación (>$2.5M)", fig.width=9, warning=FALSE}
p_ocup_mayor

```

bla bla  

#### Nivel educativo alcanzado

bla bla

```{r, echo=FALSE, fig.align="center"}
kable(Tabla_educ_mayor, caption = "Tabla : Ingreso promedio según nivel educativo alcanzado (>$2.5M)", align = "c")
```

```{r, echo=FALSE, fig.cap="Figura : Ingresos según Nivel educativo (>$2.5M)", fig.width=9, warning=FALSE}
p_educ_mayor

```


bla bla  

#### Rama de actividad

bla bla

```{r, echo=FALSE, fig.align="center"}
kable(Tabla_rama_mayor, caption = "Tabla : Ingresos según rama de actividad (>$2.5M)", align = "c")
```
 
#### Ubicacón

bla bla

```{r, echo=FALSE, fig.align="center"}
kable(Tabla_dep_mayor, caption = "Tabla : Ingresos según ubicación (>$2.5M)", align = "c")
```


## **Exploración de población con ingresos menores a $2.500.000**

bla bla

```{r, echo=FALSE, fig.align="center"}
kable(tabla1, caption = "Tabla : Numero de observaciones según ocupación", align = "c")
```
 
bla bla  

### *Asalariados*

Tienen un valor promedio de $767.130


```{r, echo=FALSE, fig.cap="Figura : Distribución de ingresos para asalariados", fig.width=9, warning=FALSE}
p_asal

```

bla bla  

#### Situación con respecto al genero

bla bla

```{r, echo=FALSE, fig.align="center"}
kable(Ingresos_1_gen, caption = "Tabla : Ingreso promedio para asalariados con respecto al género", align = "c")
```

```{r, echo=FALSE, fig.cap="Figura : Distribución de ingresos según el género", fig.width=9, warning=FALSE}
p_asal_gene1

```

```{r, echo=FALSE, fig.cap="Figura : Distribución de ingresos según el género", fig.width=9, warning=FALSE}
p_asal_gene2

```

### *No asalariados*

Tienen un valor promedio de $545.035


```{r, echo=FALSE, fig.cap="Figura : Distribución de ingresos para No asalariados", fig.width=9, warning=FALSE}
p_No_asal

```

bla bla  

#### Situación con respecto al genero

bla bla

```{r, echo=FALSE, fig.align="center"}
kable(Ingresos_2_gen, caption = "Tabla : Ingreso promedio para No asalariados con respecto al género", align = "c")
```

```{r, echo=FALSE, fig.cap="Figura : Distribución de ingresos según el género", fig.width=9, warning=FALSE}
p_No_asal_gen1

```

```{r, echo=FALSE, fig.cap="Figura : Distribución de ingresos según el género", fig.width=9, warning=FALSE}
p_No_asal_gen2

```



### *Alasariados y no asalariados*


bla bla


```{r, echo=FALSE, fig.align="center"}
kable(Ingresos_prom, caption = "Tabla : Ingreso promedio según ocupación", align = "c")
```

```{r echo=FALSE, fig.cap="Figura : Distribución de ingresos según la ocupación", fig.width=9, warning=FALSE}
p_ingresos_ocup

```

bla bla  

#### Analisis con respecto al género y la ocupación

bla bla  

```{r, echo=FALSE, fig.align="center"}
kable(Ingresos_ambos, caption = "Tabla : Ingreso promedio según género y ocupación", align = "c")
```

```{r, echo=FALSE, fig.cap="Figura : Distribución de ingresos según el género y ocupación", fig.width=9, warning=FALSE}
p_ingresos_ocup_gene

```

#### Analisis de ingresos con respecto al departamento

bla bla  

```{r, echo=FALSE, fig.align="center"}
kable(Tabla_dep2, caption = "Tabla : Ingresos según el departamento de los inmigrantes", align = "c")
```

```{r, echo=FALSE, fig.cap="Figura : Departamentos con ingreso promedio mayor por inmigrante", fig.width=9, warning=FALSE,fig.height=7}
p_dep_mejor

```

```{r, echo=FALSE, fig.cap="Figura : Departamentos con ingreso promedio menor por inmigrante", fig.width=9, warning=FALSE, fig.height=7}
p_dep_menor

```

bla bla  

#### Analisis de ingresos con respecto a la edad  

bla bla  

```{r, echo=FALSE, fig.align="center"}
kable(t4, caption = "Tabla : Ingreso promedio con respecto al rango de edad", align = "c")
```

```{r echo=FALSE, fig.cap="Figura : Ingresos de inmigrantes según el rango de edad", fig.width=9, message=FALSE, warning=FALSE}
p_ingresos_edad

```

bla bla    

#### Analisis de ingresos con respecto al nivel educativo alcanzado  

bla bla  

```{r, echo=FALSE, fig.align="center"}
kable(t5, caption = "Tabla : Ingreso promedio con respecto al nivel educativo", align = "c")
```

```{r echo=FALSE, fig.cap="Figura : Ingresos de inmigrantes según el nivel eductivo alcanzado", fig.width=9, message=FALSE, warning=FALSE}
p_ingresos_educ

```

bla bla  

#### Analisis de ingresos con respecto a las ramas de actividad  

bla bla  

bla bla  

```{r, echo=FALSE, fig.align="center"}
kable(Tabla_rama1, caption = "Tabla : Ingreso según rama de actividad (<= $2.5M)", align = "c")
```

bla bla  

```{r, echo=FALSE, fig.align="center"}
kable(Tabla_rama2, caption = "Tabla : Ingreso según rama de actividad, para toda la población ", align = "c")
```

bla bla  

#### Analisis de ingresos según departamento y rama de actividad  

bla bla  

```{r, echo=FALSE, fig.align="center"}
kable(Tabla_Dep_Rama_1, caption = "Tabla : Rama de actividad con mayor ingreso promedio por departamento (<= $2.5M) ", align = "c")
```

bla bla

```{r, echo=FALSE, fig.align="center"}
kable(Tabla_Dep_Rama_2, caption = "Tabla : Rama de actividad con mayor ingreso promedio por departamento, sin filtros de ingreso", align = "c")
```

bla bla  

#### Analisis de ingresos según género y edad  

bla bla  

```{r, echo=FALSE, fig.align="center"}
kable(Ingresos_gen_edad, caption = "Tabla : Ingreso promedio según género y edad", align = "c")
```

```{r, echo=FALSE, fig.cap="Figura : Ingresos de inmigrantes según el género y el rango de edad", fig.width=10, warning=FALSE}
p_ingresos_gen_edad

```

bla bla  

#### Analisis de ingresos según la edad y el nivel educativo alcanzado  

bla bla  

```{r, echo=FALSE, fig.align="center"}
kable(Ingresos_edad_educ, caption = "Tabla : Ingreso promedio según edad y nivel educativo", align = "c")
```

```{r, echo=FALSE, fig.cap="Figura : Ingresos de inmigrantes según rango de edad y nivel educativo", fig.width=13, warning=FALSE, fig.height=7}
p_ingresos_edad_educ

```

bla bla  




# ***Conclusiones***









